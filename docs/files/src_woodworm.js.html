<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/woodworm.js - Woodworm.js API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="Woodworm.js API" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Woodworm.html">Woodworm</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/woodworm.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
;
(function($, window, document, undefined) {

	&quot;use strict&quot;;

	if(!$ || !window.jQuery){
		// window.Woodworm = Woodworm;
		// window.catchClick = function(book, chapter, verse){
		// 	window.Woodworm.prototype.verseClick(book, chapter, verse);
		// }
		console.error(&quot;Woodworm: jQuery not included. Woodworm needs jQuery to do it&#x27;s thang.&quot;); 
	}

	var name = &quot;Woodworm&quot;,
		defaults = {
			book: &quot;Genesis&quot;,
			chapter: 1,
			verse: 1,
			selected_verses: []
		};

	/**
	 * @class  Woodworm
	 * @param {jQuery element} element The element woodworm will build upon.
	 * @param {Object} options Any options passed to overide the defaults.
	 *
	 * @constructor
	 */
	function Woodworm(element, options) {
		if(typeof(element) == &#x27;string&#x27; &amp;&amp; $(&#x27;#&#x27; + element).length &gt; 0){
			this.element = element;
			this.settings = $.extend({}, defaults, options);
			this._defaults = defaults;
			this._name = name;
			this.init();
		}else{
			this.err(&quot;Something&#x27;s not right with the element you provided: &quot;, element)
		}        
	}

	$.extend(Woodworm.prototype, {
		/**
		 * @method Init 
		 * @return {[type]} [description]
		 */
		init: function() {             
			this.getChapter();
			console.log(&quot;xD&quot;);
		},
		getChapter: function(book, chapter, callback){
			//Todo: add front-end validation for book, chapter, verse
			if(typeof(book) !== &quot;function&quot;){
				this.options.chapter = chapter ? parseInt(chapter) : this.options.chapter;;
				this.options.book = book ? book : this.options.book;
			}else {
				callback = book;	
			}
			// Whats going on here is an attempt to preserve context in the midst of $getJson
			// I had trouble getting the callback to run using $.ajax
			// Running the naked json call coming back from bible.org woulnd&#x27;t work since render
			// is a part of the Woodworm object and there could be multiple instances in the dom.
			// So this is what I came up with. For now.
			this.getData(this.render, callback, this);
		},
		render: function(verses, context){
			context.element.empty();
			for (var i = 0; i &lt; verses.length; i++) {
				var book = verses[i].bookname;
				var chapter = verses[i].chapter;
				var verse = verses[i].verse;
				if(verses[i].title){
					context.element.append(&#x27;&lt;h4&gt;&#x27; + verses[i].title + &#x27;&lt;/h4&gt;&#x27;);
					context.element.append(&quot;&lt;div class=&#x27;p&#x27; id=&quot; + book + chapter + &#x27;-&#x27; + verse + &quot; onclick=\&quot;catchClick(&#x27;&quot; + book + &quot;&#x27;,&quot; +chapter+&quot;,&quot;+verse+&quot;)\&quot;&gt;&lt;span class=&#x27;content&#x27;&gt;&lt;/span&gt;&lt;span class=&#x27;verse v1&#x27; data-usfm=&#x27;JHN.1.1&#x27;&gt;&lt;span class=&#x27;label&#x27;&gt;&quot; + verses[i].verse + &quot;&lt;/span&gt;&lt;span class=&#x27;content&#x27;&gt;&quot; + verses[i].text + &quot;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&quot;);
				}else{
					context.element.append(&quot;&lt;div class=&#x27;p&#x27; id=&quot; + book + chapter + &#x27;-&#x27; + verse + &quot; onclick=\&quot;catchClick(&#x27;&quot; + book + &quot;&#x27;,&quot; +chapter+&quot;,&quot;+verse+&quot;)\&quot;&gt;&lt;span class=&#x27;content&#x27;&gt;&lt;/span&gt;&lt;span class=&#x27;verse v1&#x27; data-usfm=&#x27;JHN.1.1&#x27;&gt;&lt;span class=&#x27;label&#x27;&gt;&quot; + verses[i].verse + &quot;&lt;/span&gt;&lt;span class=&#x27;content&#x27;&gt;&quot; + verses[i].text + &quot;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&quot;);
				}
			};
		},
		getData: function(innerCallback, outerCallback, context){
			// Not specifying a callback name since that wont work (reason given above). done() is still returning the data.
			// So this is basically a way to get around Same Origiin problems.
			$.getJSON(&#x27;http://labs.bible.org/api/?passage=&#x27; + context.options.book + &#x27;%20&#x27; + context.options.chapter + &#x27;&amp;type=json&amp;callback=?&#x27;).done(function(args){				
				innerCallback(args, context);
				if(outerCallback)
					outerCallback(args, context);
			});
		},
		status: function(){
			return this.defaults;
		},
		verseClick: function(book, chapter, verse){

			function toggleSelected(verse, verses){
				var deleted;
				$.grep(verses, function(e, i){ 
					if(verse.verse == e.verse &amp;&amp; verse.book == e.book &amp;&amp; verse.chapter == e.chapter){
						verses = verses.splice(i,1);
						deleted = true;
					}
				});
				if(!deleted)
					verses.push(verse);
				
				console.log(verses)
			}

			if($(&#x27;#&#x27;+book+chapter+&#x27;-&#x27;+verse).css(&#x27;background-color&#x27;) != &quot;rgb(255, 255, 0)&quot;){
				$(&#x27;#&#x27;+book+chapter+&#x27;-&#x27;+verse).css(&#x27;background-color&#x27;, &#x27;yellow&#x27;);
				// this.defaults.selected_verses.push({book:book, chapter:chapter, verse:verse});
			}else{
				$(&#x27;#&#x27;+book+chapter+&#x27;-&#x27;+verse).css(&#x27;background-color&#x27;, &#x27;white&#x27;);	
			}
			toggleSelected({book: book, chapter: chapter, verse: verse}, this.defaults.selected_verses);

		},
		validate: function(book,chapter,verse){

		},
		err: function(msg){
			console.error(msg);
		}
	});


	$.fn[name] = function(options) {
		return this.each(function() {
			if (!$.data(this, &quot;plugin_&quot; + name)) {
				$.data(this, &quot;plugin_&quot; + name, new Woodworm(this, options));
			}
		});
	};

})(jQuery, window, document);
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
